"use strict";

exports.__esModule = true;
exports.renderHTML = renderHTML;

const fs = require(`fs-extra`);

const path = require(`path`);

const Promise = require(`bluebird`); // copied from https://github.com/markdalgleish/static-site-generator-webpack-plugin/blob/master/index.js#L161


const generatePathToOutput = outputPath => {
  let outputFileName = outputPath.replace(/^(\/|\\)/, ``); // Remove leading slashes for webpack-dev-server

  if (!/\.(html?)$/i.test(outputFileName)) {
    outputFileName = path.join(outputFileName, `index.html`);
  }

  return path.join(process.cwd(), `public`, outputFileName);
};

function renderHTML({
  htmlComponentRendererPath,
  paths,
  concurrency
}) {
  return Promise.map(paths, path => new Promise((resolve, reject) => {
    const htmlComponentRenderer = require(htmlComponentRendererPath);

    try {
      htmlComponentRenderer.default(path, (throwAway, htmlString) => {
        resolve(fs.outputFile(generatePathToOutput(path), htmlString));
      });
    } catch (e) {
      reject(e);
    }
  }), {
    concurrency
  });
}
//# sourceMappingURL=worker.js.map