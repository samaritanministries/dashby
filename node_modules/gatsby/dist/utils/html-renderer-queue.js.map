{"version":3,"sources":["../../src/utils/html-renderer-queue.js"],"names":["convertHrtime","require","Worker","default","numWorkers","chunk","workerPool","resolve","module","exports","htmlComponentRendererPath","pages","activity","start","process","hrtime","segments","concurrency","Promise","all","map","paths","renderHTML","setStatus","length","seconds","toFixed"],"mappings":";;;;;;AAAA,MAAMA,gBAAgBC,QAAS,gBAAT,CAAtB;;AACA,MAAMC,SAASD,QAAS,aAAT,EAAuBE,OAAtC;;AACA,MAAMC,aAAaH,QAAS,oBAAT,KAAiC,CAApD;;iBACkBA,QAAS,QAAT,C;MAAVI,K,YAAAA,K;;AAER,MAAMC,aAAa,IAAIJ,MAAJ,CAAWD,QAAQM,OAAR,CAAiB,UAAjB,CAAX,EAAwC;AACzDH;AADyD,CAAxC,CAAnB;;AAIAI,OAAOC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,yBAAP,EAAkCC,KAAlC,EAAyCC,QAAzC,EAAsD;AACrE,UAAMC,QAAQC,QAAQC,MAAR,EAAd;AACA,UAAMC,WAAWX,MAAMM,KAAN,EAAaP,UAAb,CAAjB;AACA,UAAMa,cAAc,EAApB;AAEA,UAAMC,QAAQC,GAAR,CACJH,SAASI,GAAT,CAAaC,SACXf,WAAWgB,UAAX,CAAsB;AAAEZ,+BAAF;AAA6BW,WAA7B;AAAoCJ;AAApC,KAAtB,CADF,CADI,CAAN;;AAMA,QAAIL,QAAJ,EAAc;AACZA,eAASW,SAAT,CACG,GAAEZ,MAAMa,MAAO,IAAGb,MAAMa,MAAO,IAAG,CACjCb,MAAMa,MAAN,GAAexB,cAAcc,QAAQC,MAAR,CAAeF,KAAf,CAAd,EAAqCY,OADnB,EAEjCC,OAFiC,CAEzB,CAFyB,CAEtB,eAHf;AAKD;AACF,GAlBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const convertHrtime = require(`convert-hrtime`)\nconst Worker = require(`jest-worker`).default\nconst numWorkers = require(`physical-cpu-count`) || 1\nconst { chunk } = require(`lodash`)\n\nconst workerPool = new Worker(require.resolve(`./worker`), {\n  numWorkers,\n})\n\nmodule.exports = async (htmlComponentRendererPath, pages, activity) => {\n  const start = process.hrtime()\n  const segments = chunk(pages, numWorkers)\n  const concurrency = 30\n\n  await Promise.all(\n    segments.map(paths =>\n      workerPool.renderHTML({ htmlComponentRendererPath, paths, concurrency })\n    )\n  )\n\n  if (activity) {\n    activity.setStatus(\n      `${pages.length}/${pages.length} ${(\n        pages.length / convertHrtime(process.hrtime(start)).seconds\n      ).toFixed(2)} pages/second`\n    )\n  }\n}\n"],"file":"html-renderer-queue.js"}