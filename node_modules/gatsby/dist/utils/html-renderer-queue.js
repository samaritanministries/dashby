"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

const convertHrtime = require(`convert-hrtime`);

const Worker = require(`jest-worker`).default;

const numWorkers = require(`physical-cpu-count`) || 1;

const _require = require(`lodash`),
      chunk = _require.chunk;

const workerPool = new Worker(require.resolve(`./worker`), {
  numWorkers
});

module.exports =
/*#__PURE__*/
function () {
  var _ref = (0, _asyncToGenerator2.default)(function* (htmlComponentRendererPath, pages, activity) {
    const start = process.hrtime();
    const segments = chunk(pages, numWorkers);
    const concurrency = 30;
    yield Promise.all(segments.map(paths => workerPool.renderHTML({
      htmlComponentRendererPath,
      paths,
      concurrency
    })));

    if (activity) {
      activity.setStatus(`${pages.length}/${pages.length} ${(pages.length / convertHrtime(process.hrtime(start)).seconds).toFixed(2)} pages/second`);
    }
  });

  return function (_x, _x2, _x3) {
    return _ref.apply(this, arguments);
  };
}();
//# sourceMappingURL=html-renderer-queue.js.map