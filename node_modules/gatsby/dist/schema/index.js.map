{"version":3,"sources":["../../src/schema/index.js"],"names":["_","require","GraphQLSchema","GraphQLObjectType","mergeSchemas","buildNodeTypes","buildNodeConnections","store","invariant","module","exports","parentSpan","typesGQL","connections","values","nodes","mapValues","isEmpty","thirdPartySchemas","getState","gatsbySchema","query","name","fields","schema","schemas","dispatch","type","payload"],"mappings":";;;;;;AACA,MAAMA,IAAIC,QAAS,QAAT,CAAV;;iBAC6CA,QAAS,SAAT,C;MAArCC,a,YAAAA,a;MAAeC,iB,YAAAA,iB;;kBACEF,QAAS,eAAT,C;MAAjBG,Y,aAAAA,Y;;AAER,MAAMC,iBAAiBJ,QAAS,oBAAT,CAAvB;;AACA,MAAMK,uBAAuBL,QAAS,0BAAT,CAA7B;;kBACkBA,QAAS,UAAT,C;MAAVM,K,aAAAA,K;;AACR,MAAMC,YAAYP,QAAS,WAAT,CAAlB;;AAEAQ,OAAOC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAO;AAAEC;AAAF,GAAP,EAA0B;AACzC,UAAMC,iBAAiBP,eAAe;AAAEM;AAAF,KAAf,CAAvB;AACA,UAAME,cAAcP,qBAAqBN,EAAEc,MAAF,CAASF,QAAT,CAArB,CAApB,CAFyC,CAIzC;;AACA,UAAMG,QAAQf,EAAEgB,SAAF,CAAYJ,QAAZ,EAAuB,MAAvB,CAAd;;AAEAJ,cAAU,CAACR,EAAEiB,OAAF,CAAUF,KAAV,CAAX,EAA8B,kCAA9B;AACAP,cAAU,CAACR,EAAEiB,OAAF,CAAUJ,WAAV,CAAX,EAAoC,wCAApC;AAEA,UAAMK,oBAAoBX,MAAMY,QAAN,GAAiBD,iBAAjB,IAAsC,EAAhE;AAEA,UAAME,eAAe,IAAIlB,aAAJ,CAAkB;AACrCmB,aAAO,IAAIlB,iBAAJ,CAAsB;AAC3BmB,cAAO,eADoB;AAE3BC,kCAAaV,WAAb,EAA6BE,KAA7B;AAF2B,OAAtB;AAD8B,KAAlB,CAArB;AAOA,UAAMS,SAASpB,aAAa;AAC1BqB,eAAS,CAACL,YAAD,EAAe,GAAGF,iBAAlB;AADiB,KAAb,CAAf;AAIAX,UAAMmB,QAAN,CAAe;AACbC,YAAO,YADM;AAEbC,eAASJ;AAFI,KAAf;AAID,GA3BD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst _ = require(`lodash`)\nconst { GraphQLSchema, GraphQLObjectType } = require(`graphql`)\nconst { mergeSchemas } = require(`graphql-tools`)\n\nconst buildNodeTypes = require(`./build-node-types`)\nconst buildNodeConnections = require(`./build-node-connections`)\nconst { store } = require(`../redux`)\nconst invariant = require(`invariant`)\n\nmodule.exports = async ({ parentSpan }) => {\n  const typesGQL = await buildNodeTypes({ parentSpan })\n  const connections = buildNodeConnections(_.values(typesGQL))\n\n  // Pull off just the graphql node from each type object.\n  const nodes = _.mapValues(typesGQL, `node`)\n\n  invariant(!_.isEmpty(nodes), `There are no available GQL nodes`)\n  invariant(!_.isEmpty(connections), `There are no available GQL connections`)\n\n  const thirdPartySchemas = store.getState().thirdPartySchemas || []\n\n  const gatsbySchema = new GraphQLSchema({\n    query: new GraphQLObjectType({\n      name: `RootQueryType`,\n      fields: { ...connections, ...nodes },\n    }),\n  })\n\n  const schema = mergeSchemas({\n    schemas: [gatsbySchema, ...thirdPartySchemas],\n  })\n\n  store.dispatch({\n    type: `SET_SCHEMA`,\n    payload: schema,\n  })\n}\n"],"file":"index.js"}